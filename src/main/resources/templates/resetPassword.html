<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</title>
    <link rel="stylesheet" th:href="@{/css/resetPassword.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="login-container">
    <h1>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</h1>
    <form id="resetPasswordForm"> <!-- formì˜ actionì€ ì œê±°í•˜ê³ , JavaScriptë¡œ ì²˜ë¦¬ -->
        <input type="hidden" name="email" id="email" th:value="${email}"> <!-- ì´ë©”ì¼ íˆë“  í•„ë“œ -->

        <div class="input-group" style="position: relative;">
            <label for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ (8~20ìë¦¬)</label>
            <input type="password" name="newPassword" id="newPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”." required minlength="8" maxlength="20">
            <span class="eye-icon" id="toggleNewPassword">ğŸ‘ï¸</span> <!-- ëˆˆ ì•„ì´ì½˜ -->
        </div>

        <div class="input-group" style="position: relative;">
            <label for="confirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input type="password" name="confirmPassword" id="confirmPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”." required>
            <span class="eye-icon" id="toggleConfirmPassword">ğŸ‘ï¸</span> <!-- ëˆˆ ì•„ì´ì½˜ -->
        </div>

        <button type="button" onclick="submitForm()">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</button>
        <div id="alertMessage" class="alert" style="display:none;"></div> <!-- ê²½ê³  ë©”ì‹œì§€ ì˜ì—­ -->
    </form>
</div>

<script>
    // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¸°ê¸° ê¸°ëŠ¥
    function togglePasswordVisibility(inputId, iconId) {
        const inputField = document.getElementById(inputId);
        const icon = document.getElementById(iconId);

        if (inputField.type === "password") {
            inputField.type = "text"; // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ
            icon.textContent = "ğŸ™ˆ"; // ì•„ì´ì½˜ ë³€ê²½ (ìˆ¨ê¸°ê¸°)
        } else {
            inputField.type = "password"; // ë¹„ë°€ë²ˆí˜¸ ìˆ¨ê¸°ê¸°
            icon.textContent = "ğŸ‘ï¸"; // ì•„ì´ì½˜ ë³€ê²½ (ë³´ê¸°)
        }
    }

    document.getElementById('toggleNewPassword').addEventListener('click', function() {
        togglePasswordVisibility('newPassword', 'toggleNewPassword');
    });

    document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
        togglePasswordVisibility('confirmPassword', 'toggleConfirmPassword');
    });

    function submitForm() {
        const email = $('#email').val();
        const newPassword = $('#newPassword').val();
        const confirmPassword = $('#confirmPassword').val();
        const alertMessage = $('#alertMessage');

        // ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ ê²€ì¦
        if (newPassword.length < 8 || newPassword.length > 20) {
            alertMessage.text('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ìì—ì„œ 20ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.').show();
            return;
        } else {
            alertMessage.hide();
        }

        // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸
        if (newPassword !== confirmPassword) {
            alertMessage.text('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.').show();
            return;
        } else {
            alertMessage.hide();
        }

        // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ (AJAX)
        $.ajax({
            url: '/resetPassword',
            type: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            data: {
                email: email,
                newPassword: newPassword // ë¹„ë°€ë²ˆí˜¸ ì „ì†¡
            },
            success: function(response) {
                alert(response); // ì„±ê³µ ë©”ì‹œì§€
                window.location.href = '/login'; // ì„±ê³µ í›„ ë¦¬ë””ë ‰ì…˜
            },
            error: function(xhr) {
                if (xhr.responseText) {
                    alertMessage.text(xhr.responseText).show(); // ì˜¤ë¥˜ ë©”ì‹œì§€
                } else {
                    alertMessage.text('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.').show();
                }
            }
        });
    }
</script>
</body>
</html>
